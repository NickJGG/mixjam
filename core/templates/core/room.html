{% extends 'core/base_auth.html' %}
{% load static %}

{% block title %}{{ room.title }}{% endblock %}

{% block css %}
	{{ block.super }}

	<link rel = "stylesheet" type = "text/css" href = "{% static 'css/room.css' %}">
	<link rel = "stylesheet" type = "text/css" href = "{% static 'css/panel.css' %}">
	<link rel = "stylesheet" type = "text/css" href = "{% static 'css/subpanel.css' %}">
	<link rel = "stylesheet" type = "text/css" href = "{% static 'css/settings.css' %}">

	{% if room.banner_color != None %}

		<style>
			:root{
				--banner-color: #{{ room.banner_color }};
			}
		</style>

	{% endif %}

{% endblock %}

{% block page_name %}{{ room.title }}{% endblock %}

{% block page_name_after %}

	{% if room.mode != 'closed' or room.leader == user %}

		<div class = "subtitle-container">
			<img id = "invite-link" src = "{% static 'img/icons/link-white-50.png' %}">
			<div class = "subtitle-label" style = "width: 600%; left: -250%">
				<p>Copy Invite Link</p>
			</div>
		</div>
		
		<input id = "invite-url" type = "text" style = "position: absolute; top: -1000px; left: -1000px;" value = "{{ room.get_invite_link }}">

	{% endif %}

{% endblock %}

{% block panel_labels %}

	<div class = "panel-label">Home</div>
	<p class = "panel-label selected">Room</p>
	<!-- <p class = "panel-label">Activities</p> -->

	{% if room.leader == user %}
		<p class = "panel-label">Settings</p>
	{% endif %}

{% endblock %}

{% block user_container_before %}

	<div id = "notification-container">
		
	</div>
	<div id = "connection-container" class = "subtitle-container" style = "--background-image: url({% static 'img/icons/connection-white-96.png' %})">
		<div id = "connection-status" class = "subtitle-image colored"></div>
		<div id = "connection-status-label" class = "subtitle-label">
			<p>Disconnected</p>
		</div>
	</div>

{% endblock %}

{% block panel_container %}
	{% if new_room %}

		<div id = "user-message-container">
			<div id = "new-user-message">
				<img src = "{{ room.playlist_image_url }}">
				
				{% if user == room.leader %}

					<p id = "message-title">Welcome to your new room</p>
					<p id = "message-body">Its a little lonely in here, why don't we change that?</p>
					<div id = "message-tips">
						<div class = "message-tip">Get the invite link by clicking on the link icon next to your room name</div>
						<div class = "message-tip">Click on any song to start playback for everyone</div>
						<div class = "message-tip">To change things like the privacy mode and banner color, head to the Settings tab</div>
						<div class = "message-tip">Make sure you're connected (top right corner) to use the controls</div>
					</div>
					<div class = "settings-actions">
						<input id = "close-message" class = "gray" type = "submit" value = "Got It">
					</div>

				{% else %}

					<p id = "message-title">Welcome to {{ room.title }}</p>
					<p id = "message-body">Put on some music and enjoy your stay</p>
					<div id = "message-tips">
						<div class = "message-tip">Click on any song to start playback for everyone</div>
						<div class = "message-tip">Make sure you're connected (top right corner) to use the controls</div>
					</div>
					<div class = "settings-actions">
						<input id = "close-message" class = "gray" type = "submit" value = "Got It">
					</div>

				{% endif %}
			</div>
		</div>

	{% endif %}

	{% include 'core/blocks/panels/room/home.html' %}
	{% include 'core/blocks/panels/room/room.html' with selected=True %}
	{% include 'core/blocks/panels/room/activities.html' %}

	{% if room.leader == user %}
		{% include 'core/blocks/panels/room/settings.html' with room=room %}
	{% endif %}
	
	<div id = "player-container">
		<div id = "song-info">
			<div id = "song-image">
				<img>
			</div>
			<div id = "current-song-details">
				<p id = "current-song-name"></p>
				<p id = "current-song-artist"></p>
			</div>
		</div>
		<div id = "song-controls">
			<div id = "previous" class = "control">
				<img src = "{% static 'img/icons/rewind-white-24.png' %}">
			</div>
			<div id = "play-pause" class = "control">
				<img src = "{% if room_state.song_state.is_playing %}{% static 'img/icons/pause-white-24.png' %}{% else %}{% static 'img/icons/play-white-24.png' %}{% endif %}">
			</div>
			<div id = "next" class = "control">
				<img src = "{% static 'img/icons/fastforward-white-24.png' %}">
			</div>
		</div>
		<div id = "song-progress-container">
			<p id = "song-progress-time">- : - -</p>
			<div id = "song-progress" class = "progress-container row">
				<div class = "progress-complete">
					<div class = "progress-thumb">
						
					</div>
				</div>
				<div class = "progress-incomplete">
					
				</div>
			</div>
			<p id = "song-total-time">- : - -</p>
		</div>
		<div id = "extra-controls-container">
			<div class = "popup-container column top right">
				<div id = "devices" class = "extra-control popup-toggle">
					<div id = "devices-image" class = "extra-control-image" style = "--background-image: url({% static 'img/icons/device-white-96.png' %})">

					</div>
				</div>
				<div id = "devices-container" class = "popup-element">
					<div id = "devices-header">
						<p>Devices</p>
						<div id = "devices-options">
							<div id = "devices-refresh" class = "devices-option">
								<img src = "{% static 'img/icons/refresh-white-96.png' %}">
							</div>
						</div>
					</div>
					<div id = "device-list">
						
					</div>
				</div>
			</div>
			<div id = "volume-container">
				<div id = "volume-progress" class = "progress-container column">
					<div class = "progress-incomplete">
						
					</div>
					<div class = "progress-complete">
						<div class = "progress-thumb">
							
						</div>
					</div>
				</div>
			</div>
			<div id = "volume" class = "extra-control">
				<div id = "volume-image" class = "extra-control-image" style = "--background-image: url({% static 'img/icons/speaker-white-96.png' %})">

				</div>
			</div>
		</div>
	</div>

{% endblock %}

{% comment %} {% block right_side_panel %}

	<div class = "tab-container">
		<div class = "tab-selectors">
			<div id = "tab-label-chat" class = "tab-selector">
				<p>Chat</p>
				<span id = "unread-count">0</span>
			</div>
			<div class = "tab-selector selected">
				<p>Users</p>
			</div>
		</div>

		{% include 'core/blocks/tabs/room/chat.html' %}
		{% include 'core/blocks/tabs/room/users.html' with selected=True room=room offline_users=offline_users active_users=room.active_users.all %}
	</div>

{% endblock %} {% endcomment %}

{% block selector_options %}

	<div id = "selector-users" class = "selector-option">
		<img class = "side-panel-items-icon" src = "{% static 'img/icons/room-users-white-96.png' %}">
	</div>

{% endblock %}

{% block hide_friends %}{% endblock %}
{% block hide_friends_icon %}{% static 'img/icons/room-users-white-96.png' %}{% endblock %}

{% block selector_groups %}

	<div id = "group-users" class = "side-panel-items-group selected">
		<div class = "side-panel-items-subgroup">

			{% for user in room.active_users.all %}

				<div id = "user-{{ user.username }}" class = "popup-container row top left margin">
					<div class = "side-panel-item room popup-toggle">
						{% include 'core/blocks/profile-picture.html' with user=user width='100%' height='100%' %}
						<p class = "item-label no-underline">{{ user.username }}</p>
					</div>
					<div class = "popup-element room-preview">
						<a class = "no-underline" href>
							<div class = "preview-header">
								<p class = "preview-title">{{ user.username }}</p>
								<div class = "preview-join">
									<img src = "{% static 'img/icons/right-white-96.png' %}">
								</div>
							</div>
						</a>
						<div class = "preview-users-container">
							
						</div>
					</div>
				</div>
					
			{% endfor %}

		</div>
		<div class = "side-panel-items-subgroup grayscale">

			{% for user in offline_users %}

				<div id = "user-{{ user.username }}" class = "popup-container row top left margin">
					<div class = "side-panel-item room popup-toggle grayscale">
						{% include 'core/blocks/profile-picture.html' with user=user width='100%' height='100%' %}
						<p class = "item-label no-underline">{{ user.username }}</p>
					</div>
					<div class = "popup-element room-preview">
						<a class = "no-underline" href>
							<div class = "preview-header">
								<p class = "preview-title">{{ user.username }}</p>
								<div class = "preview-join">
									<img src = "{% static 'img/icons/right-white-96.png' %}">
								</div>
							</div>
						</a>
						<div class = "preview-users-container">
							
						</div>
					</div>
				</div>
					
			{% endfor %}
			
		</div>
	</div>

{% endblock %}

{% block js %}
	{{ block.super }}

	{% static 'img/icons/pause-white-24.png' as pausePath %}
	{% static 'img/icons/play-white-24.png' as playPath %}
	{% static '' as static_url %}
	{{ room_state|json_script:"roomState" }}
	{{ room.code|json_script:"code" }}
	{{ user.username|json_script:"username" }}
	{{ room_state.song_state.is_playing|json_script:"is_playing" }}
	
	<script src = "{% static 'js/room.js' %}"></script>
	<script src = "{% static 'js/panel.js' %}"></script>
	<script src = "{% static 'js/tab.js' %}"></script>
	<script src = "{% static 'js/settings.js' %}"></script>
	<script type = "text/javascript">
		var code = JSON.parse(document.getElementById('code').textContent),
			staticUrl = '{{ static_url }}',
			pausePath = '{{ pausePath }}',
			playPath = '{{ playPath }}',
			playing = "{{ room_state.song_state.is_playing }}" == "True",
			roomState = JSON.parse(document.getElementById('roomState').textContent);
	</script>

{% endblock %}