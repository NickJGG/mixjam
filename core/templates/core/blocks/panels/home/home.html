{% load static %}
{% load util %}

<div id = "panel-home" class = "panel {% if selected == True %}selected{% endif %}">
	<div class = "widget-container" style = "--rows: 2; --columns: 4">
        <div class = "widget-list">
            <div class = "widget-list-header">
                <p class = "widget-list-label">Rooms</p>
            </div>
            <div class = "widgets">
                {% if user.userprofile.most_recent_room %}

                    <a class = "no-underline" href = "{% url 'room' room_code=user.userprofile.most_recent_room.code %}">
                        <div class = "widget link" style = "--background-image: url({{ user.userprofile.most_recent_room.playlist_image_url }})">
                            {% if user.userprofile.most_recent_room.playlist.playing %}

                                <div class = "room-playing">
                                    <div class = "room-preview-wrapper">
                                        <img class = "playing-image" src = "{% static 'img/icons/logo.gif' %}">
                                        <div class = "room-users-container">
                                            <p class = "section-label">Listening • {{ user.userprofile.most_recent_room.active_users.all|length }}</p>
                                            <div class = "room-users-wrapper">
                                                <div class = "room-users">
                                                    {% for user in user.userprofile.most_recent_room.active_users.all %}
                                                        <div class = "room-user" style = "--user-color: #{{ user.userprofile.background_color }}">
                                                            <div class = "room-user-background"></div>
                                                            <div class = "pfp-wrapper">
                                                                {% include 'core/blocks/profile-picture.html' with user=user width='100%' height='100%' %}
                                                            </div>
                                                            <p>{{ user.username }}</p>
                                                        </div>
        
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            {% endif %}

                            <div class = "widget-image">
                                
                            </div>
                            <div class = "widget-info">
                                <div class = "widget-label"> 
                                    <p class = "widget-name" title = "{{ user.userprofile.most_recent_room.title }}">{{ user.userprofile.most_recent_room.title }}</p>
                                </div>
                                <div class = "room-creator">
                                    <img src = "{% static 'img/icons/crown-96.png' %}">
					
					                <p>{{ user.userprofile.most_recent_room.leader.username }}</p>
                                </div>
                            </div>
                        </div>
                    </a>

                {% endif %}

                {% for room in other_rooms %}

                    <a class = "no-underline" href = "{% url 'room' room_code=room.code %}">
                        <div class = "widget link" style = "--background-image: url({{ room.playlist_image_url }})">
                            {% if room.playlist.playing %}

                                <div class = "room-playing">
                                    <div class = "room-preview-wrapper">
                                        <img class = "playing-image" src = "{% static 'img/icons/logo.gif' %}">
                                        <div class = "room-users-container">
                                            <p class = "section-label">Listening • {{ room.active_users.all|length }}</p>
                                            <div class = "room-users-wrapper">
                                                <div class = "room-users">
                                                    {% for user in room.active_users.all %}
                                                        <div class = "room-user" style = "--user-color: #{{ user.userprofile.background_color }}">
                                                            <div class = "room-user-background"></div>
                                                            <div class = "pfp-wrapper">
                                                                {% include 'core/blocks/profile-picture.html' with user=user width='100%' height='100%' %}
                                                            </div>
                                                            <p>{{ user.username }}</p>
                                                        </div>
        
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            {% endif %}
                            <div class = "widget-image">
                                
                            </div>
                            <div class = "widget-info">
                                <div class = "widget-label">
                                    <p class = "widget-name">{{ room.title }}</p>
                                </div>
                                <div class = "room-creator">
                                    <img src = "{% static 'img/icons/crown-96.png' %}">
					
					                <p>{{ room.leader.username }}</p>
                                </div>
                            </div>
                        </div>
                    </a>

                {% endfor %}
            </div>
        </div>
    </div>

    {% if room_count == 0 %}
        
        <div id = "no-rooms-container">
            <img src = "{% static 'img/not-found-96.png' %}">
            <p id = "error-message">There doesn't seem to be anything here...</p>
        </div>

    {% endif %}
</div>